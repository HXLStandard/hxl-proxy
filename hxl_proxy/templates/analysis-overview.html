{% extends "models/page.basic.html" %}
{% from 'macros/navmenu.html' import navmenu %}

{% block title %}{{ unicode(analysis.title()) }}{% endblock %}

{% block head %}
{{ super() }}
    <link href="{{ static('dataTables/media/css/jquery.dataTables.min.css') }}" rel="stylesheet" />
{% endblock %}

{% block menu %}
{{ navmenu(profile=analysis, facet='analysis-overview') }}
{% endblock %}

{% block main %}

    <ul class="breadcrumb">
      {% if not analysis.filters %}
      <li class="active">3W data</li>
      {% else %}
      <li><a href="?url={{ analysis.args.url|urlencode }}">3W data</a></li>
      {% endif %}
      {% for filter in analysis.filters %}
      {% if filter == analysis.filters|last %}
      <li class="active">{{ unicode(filter.orig) }}</li>
      {% else %}
      <li><a href="{{ analysis.overview_url(limit=filter) }}">{{ unicode(filter.orig) }}</a></li>
      {% endif %}
      {% endfor %}
    </ul>

    <h1>{{ unicode(analysis.title()) }}</h1>

    {% if analysis.description %}
    <p>{{ analysis.description }}</p>
    {% endif %}

    <p class="small"><a href="{{ analysis.args.url }}">Original dataset</a></p>

    {% if analysis.patterns %}
    <section class="row">
    {% for pattern in analysis.patterns %}
    <section class="col-lg-3 col-md-4 col-sm-6">
      <div class="panel panel-default">
      <div class="panel-heading">
      {% set entries = analysis.get_top_values(pattern[0]) %}
      <h2 class="panel-title">Top {{ pattern[1]|default('values for' + pattern[0]) }} (of {{ entries|count }})</h2>
      </div>
      <div class="panel-body">
      <table class="table">
        <tbody>
          {% for entry in entries[:3] %}
          <tr>
            <th><a href="{{ analysis.overview_url(pattern[0], entry.value) }}">{{ unicode(entry.orig) }}</a></th>
            <td>{{ entry.count }}</td>
            <td>{{ '{0:.1f}%'.format(entry.percentage * 100) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
      <div class="panel-footer">
        <a class="btn btn-default" href="{{ analysis.tag_url(pattern[0]) }}">see all {{ pattern[1]|default('values for' +
      pattern[0]) }}</a>
      </div>
      </div>
    </section>
    {% endfor %}
    </section>
    {% else %}
    {% set profile=analysis %}
    {% set source=analysis.source %}
    {% include 'snippets/hxltable.html' %}
    {% endif %}

{% endblock %}

{% block scripts %}
{{ super() }}
{% endblock %}
