{% extends "models/page.basic.html" %}
{% from 'macros/navmenu.html' import navmenu %}
{% from 'macros/selectors.html' import selectors_big %}
{% from 'macros/params.html' import params %}

{% set nav_filter='active' %}

{% block menu %}
{{ navmenu(profile, key=key, facet='source') }}
{% endblock %}

{% block title %}Choose HXL dataset{% endblock %}

{% block main %}
<main>
  <h1>Step 1. choose a dataset</h1>

  <div class="lead">
    <p>
      Want to make your humanitarian data dance?  Add some <a
      href="http://hxlstandard.org">HXL hashtags</a>, then let's get
      started &hellip;
    </p>
  </div>

  <div class="choosers panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">Option #1: choose your dataset from a cloud service</h2>
    </div>
    <div class="panel-body">
      <a href="#" onclick="return hxl_proxy.doHDX('#dataset-url', true);">
        <img src="{{ static('images/hdx-logo.png') }}" alt="Humanitarian Data Exchange logo" />
        <span>HDX</span>
      </a>
      <a href="#" onclick="return hxl_proxy.doDropbox('#dataset-url', true);">
        <img src="{{ static('images/dropbox-logo.png') }}" alt="Dropbox logo" />
        <span>Dropbox</span>
      </a>
      <a href="#" onclick="return hxl_proxy.doGDrive('#dataset-url', true);">
        <img src="{{ static('images/google-drive-logo.png') }}" alt="Google Drive logo" />
        <span>Google Drive</span>
      </a>
    </div>
  </div>

  <p class="h3 text-center">(or)</p>

  {% if key %}
  {% set method="POST" %}
  {% set action="/actions/save-profile" %}
  {% else %}
  {% set method="GET" %}
  {% set action="/data/edit" %}
  {% endif %}
  <div class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">Option #2: enter your dataset's URL</h2>
    </div>
    <form class="panel-body" action="{{ action }}" method="{{ method }}">
      <fieldset>
        <div class="form-group required">
          <input id='dataset-url'
                 class="form-control" 
                 name="url"
                 type="url"
                 required="required"
                 value="{{ profile.args.url }}"
                 placeholder="http://example.org/dataset.csv" />
        </div>

        {% include 'snippets/filters/tagger.html' %}

        <div class="form-group pull-right">
          <button class="btn btn-success" type="submit">Next</button>
        </div>

        {% if key %}
        <input type="hidden" name="key" value="{{ key }}" />

        <div class="form-group required">
          <label for="name">Filter name</label>
          <input class="form-control" name="name" required="required" value="{{ profile.name|default('') }}"/>
        </div>

        <div class="form-group">
          <label for="description">Filter description</label>
          <textarea name="description" class="form-control">{{ profile.description|default('') }}</textarea>
        </div>

        <div class="form-group">
          <label for="schema_url">Default schema URL (for validation)</label>
          <input class="form-control" type="url" id="schema_url" name="schema_url" value="{{ profile.args.schema_url|nonone }}" />
          {{ selectors('#schema_url') }}
        </div>

        <div class="checkbox">
          <label>
            <input name="cloneable" type="checkbox"{% if profile.cloneable %} checked="checked"{% endif %} />
            Cloning allowed (will expose original URL)
          </label>
        </div>

        <div class="form-group">
          <label for="new-password">New password</label>
          <input class="form-control" name="new-password" type="password" />
        </div>

        <div class="form-group">
          <label for="password-repeat">Repeat new password</label>
          <input class="form-control" name="password-repeat" type="password" />
        </div>
        {% endif %}

        {{ params('key', 'url') }}

      </fieldset>

    </form>
  </div>
</main>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ static('hxl-proxy/hxl-proxy.js') }}"></script>
<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="sm6okywskgdecv9"></script>
<script src="http://davidmegginson.github.io/hdx-chooser/hdx.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/api.js"></script>
<script>
  hxl_proxy.setupForm();
  $(document).ready(function() {

  // add the preview warning, with total row count
  $("#preview-warning").insertBefore($("#preview-table"));

  // Remove empty GET parameters to keep URLs shorter
  $('#filter-form').submit(function () {
  var text = $(this).find(":input").filter(function () {
  return $.trim(this.value).length > 0
  }).serialize();
  window.location = '?' + text;
  return false;
  });
  
  });
</script>
{% endblock %}
