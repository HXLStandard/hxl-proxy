{% extends "models/page.basic.html" %}
{% from 'macros/navmenu.html' import navmenu %}

{% block menu %}
{{ navmenu(profile, key=key, facet='chart') }}
{% endblock %}

{% block title %}{% if label %}{{ label }} in {% endif %}{{ profile.args.name|default('Filtered HXL data') }} ({{ type }} chart){% endblock %}

{% block main %}
    <ul class="nav nav-tabs">
      <li role="presentation"{% if type=='pie' %} class="active"{% endif %}><a href="{{ add_args({'type': 'pie'}) }}">Pie</a></li>
      <li role="presentation"{% if type=='bar' %} class="active"{% endif %}><a href="{{ add_args({'type': 'bar'}) }}">Bar</a></li>
      <li role="presentation"{% if type=='column' %} class="active"{% endif %}><a href="{{ add_args({'type': 'column'}) }}">Column</a></li>
    </ul>
    <h1>
      Chart:
      {% if key %}
      <cite>{{ profile.name }}</cite>
      {% else %}
      HXL data
      {% endif %}
    </h1>

    <div id="chart_div" style="min-height:480px"></div>

    <p class="small">
      Dataset: 
      <a href="{{ data_url(profile, key) }}">
        {% if key %}
        {{ profile.name }}
        {% else %}
        {{ profile.args.url }}
        {% endif %}
      </a>
    </p>

{% endblock %}

{% block scripts %}
{{ super() }}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="{{ static('jquery/jquery.csv.js') }}"></script>
    <script type="text/javascript" src="{{ static('libhxl/hxl.js') }}"></script>
    <script type="text/javascript" src="{{ static('hxl-proxy/hxl-proxy.js') }}"></script>
    <script type="text/javascript">
      hxl_proxy.setupChart({
        data_url: "{{ data_url(profile, key, format='csv') | safe }}",
        type: "{{ type|nonone|safe }}",
        value_pattern: "{{ tag|nonone|safe }}",
        label_pattern: "{{ label|nonone|safe }}"
      });
    </script>
{% endblock %}
