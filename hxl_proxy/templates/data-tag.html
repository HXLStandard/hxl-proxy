{% extends "models/page.basic.html" %}
{% from 'macros/navmenu.html' import navmenu %}
{% from 'macros/params.html' import params %}

{% set nav_filter='active' %}

{% block menu %}
{{ navmenu(profile, key=key, facet='source') }}
{% endblock %}

{% block title %}Choose HXL dataset{% endblock %}

{% block main %}
<main>
  <h1>Add HXL tags</h1>

  {% if not profile.key or profile.cloneable %}
  <p class="alert alert-info">
    <b>Data source:</b>
    <a target="_blank" href="{{ profile.args.url}}">{{ profile.args.url }}</a>
    <a class="btn btn-info btn-xs pull-right" href="">Change</a>
  </p>
  {% endif %}

  <div class="lead">
    <p>
      We can't find any <a href="http://hxlstandard.org">HXL
      hashtags</a> in your data, but all is not lost!  You can define
      tags to go with your headers below, and the HXL Proxy will add
      them automatically.
    </p>
  </div>

  {% if key %}
  {% set method="POST" %}
  {% set action="/actions/save-profile" %}
  {% else %}
  {% set method="GET" %}
  {% set action="/data/edit" %}
  {% endif %}
  <form class="panel-body" action="{{ action }}" method="{{ method }}">

    <div class="panel-body">
      {% import 'snippets/filters/filter-variables.j2' as vars %}
      <table>
        <thead>
          <tr>
            <th></th>
            <th>Header (sub)string</th>
            <th>HXL hashtag</th>
          </tr>
          <tr>
            <td><i>E.g.</i></td>
            <td><code>Province</code></td>
            <td><code>#adm1</code></td>
          </tr>
        </thead>
        <tbody>
          {% for i in range(1,11) %}
          {% set name='tagger-%02d' % i %}
          <tr>
            <td>{{ i }}</td>
            <td><input class="form-control" name="{{ name + '-header' }}" value="{{ profile.args[name + '-header'] }}" placeholder="Header text" /></td>
            <td><input class="form-control" name="{{ name + '-tag' }}" value="{{ profile.args[name + '-tag'] }}" pattern="^{{ vars.tag_pattern }}$" title="{{ vars.tag_help }}" placeholder="{{ vars.tag_placeholder }}" /></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="form-group pull-right">
      <button class="btn btn-success" type="submit">Next</button>
    </div>

    {{ params() }}

  </form>
</main>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ static('hxl-proxy/hxl-proxy.js') }}"></script>
<script type="text/javascript" src="https://www.dropbox.com/static/api/2/dropins.js" id="dropboxjs" data-app-key="sm6okywskgdecv9"></script>
{% endblock %}
